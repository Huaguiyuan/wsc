import gen.env as envi
import numpy as np
import gen.forms as fm


class Quantum:

    def __init__(self, runVal, funcVal):

        self.runVal = runVal
        self.runVal.compSpace()
        self.funcVal = funcVal
        self.envi = envi.Environment(runVal)

    @property
    def Qf(self):

        V = self.runVal
        E = self.envi

        epsil = np.zeros(shape=(2, 2), dtype=np.complex128)
        epsil[0, 0] = V.ener
        epsil[1, 1] = -V.ener
        gA = np.dot(np.dot(fm.p3(), np.conj(V.gR).T), fm.p3())

        rv = (epsil - E.hamR) * self.funcVal \
            - self.funcVal * (epsil - E.hamA) \
            + V.gR * E.hamKG \
            - E.hamKG * gA \
            + np.dot(V.dpzg0 * E.dzhamKG \
            + 
        
        return -rv / V.lim.v
